{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "vmName": {
            "type": "string"
        },
        
        "ExclusionsPaths": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "Semicolon delimited list of file paths or locations to exclude from scanning"
            }
        },
        "ExclusionsExtensions": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "Semicolon delimited list of file extensions to exclude from scanning"
            }
        },
        "ExclusionsProcesses": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "Semicolon delimited list of process names to exclude from scanning"
            }
        },
        "RealtimeProtectionEnabled": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
                "description": "Indicates whether or not real time protection is enabled (default is true)"
            }
        },
        "ScheduledScanSettingsIsEnabled": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
                "description": "Indicates whether or not custom scheduled scan settings are enabled (default is false)"
            }
        },
        "ScheduledScanSettingsScanType": {
            "type": "string",
            "defaultValue": "Quick",
            "metadata": {
                "description": "Indicates whether scheduled scan setting type is set to Quick or Full (default is Quick)"
            }
        },
        "ScheduledScanSettingsDay": {
            "type": "string",
            "defaultValue": "7",
            "metadata": {
                "description": "Day of the week for scheduled scan (1-Sunday, 2-Monday, ..., 7-Saturday)"
            }
        },
        "ScheduledScanSettingsTime": {
            "type": "string",
            "defaultValue": "120",
            "metadata": {
                "description": "When to perform the scheduled scan, measured in minutes from midnight (0-1440). For example: 0 = 12AM, 60 = 1AM, 120 = 2AM."
            }
        }
    },
"variables": {

 "vmListArray" : "[split(parameters('vmName'),',')]"


},
    "resources": [
        {
            "name": "[concat(variables('vmListArray')[copyIndex()],'/IaaSAntimalware')]",
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "location": "North Central US",
            "apiVersion": "2015-06-15",
            "copy": {
                "name": "vmAVcopy",
                "count": "[length(variables('vmListArray'))]"
            },
            "properties": {
                "publisher": "Microsoft.Azure.Security",
                "type": "IaaSAntimalware",
                "typeHandlerVersion": "1.3",
                "autoUpgradeMinorVersion": true,
                "settings": {
                    "AntimalwareEnabled": true,
                    "RealtimeProtectionEnabled": "[parameters('RealtimeProtectionEnabled')]",
                    "ScheduledScanSettings": {
                        "isEnabled": "[parameters('ScheduledScanSettingsIsEnabled')]",
                        "day": "[parameters('ScheduledScanSettingsDay')]",
                        "time": "[parameters('ScheduledScanSettingsTime')]",
                        "scanType": "[parameters('ScheduledScanSettingsScanType')]"
                    },
                    "Exclusions": {
                        "Extensions": "[parameters('ExclusionsExtensions')]",
                        "Paths": "[parameters('ExclusionsPaths')]",
                        "Processes": "[parameters('ExclusionsProcesses')]"
                    }
                }
            }
        }
    ]
}